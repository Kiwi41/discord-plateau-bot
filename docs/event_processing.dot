digraph event_processing {
    rankdir=TB;
    bgcolor="white";
    
    // Styling
    node [shape=box, style=filled, fontname="Arial", fontsize=10];
    edge [fontname="Arial", fontsize=9];
    
    // Input
    start [label="ğŸ“… Traitement vendredi\n(date spÃ©cifique)", 
           shape=ellipse, fillcolor="#4caf50", fontcolor="white"];
    
    // API Call with retry
    subgraph cluster_api {
        label="ğŸŒ Appels API Discord";
        style=filled;
        fillcolor="#e3f2fd";
        
        api_call [label="ğŸ”— guild.scheduledEvents.fetch()\nRÃ©cupÃ©ration Ã©vÃ©nements", fillcolor="#bbdefb"];
        timeout_check [label="â±ï¸ Timeout check\n(30 secondes)", fillcolor="#bbdefb"];
        retry_logic [label="ğŸ”„ Retry logic\n2s â†’ 4s â†’ 6s", fillcolor="#ffcdd2"];
    }
    
    // Event filtering
    subgraph cluster_filter {
        label="ğŸ” Filtrage Ã©vÃ©nements";
        style=filled;
        fillcolor="#e8f5e8";
        
        filter_date [label="ğŸ“… Filtrer par date\n(vendredi cible)", fillcolor="#c8e6c9"];
        filter_keywords [label="ğŸ” Mots-clÃ©s\n['plateau', 'soirÃ©e', 'jeu']", fillcolor="#c8e6c9"];
        recurrent_priority [label="ğŸ¯ PrioritÃ© rÃ©currents\n(EVENT_ID si configurÃ©)", fillcolor="#c8e6c9"];
    }
    
    // Data extraction
    subgraph cluster_extract {
        label="ğŸ“ Extraction donnÃ©es";
        style=filled;
        fillcolor="#fff3e0";
        
        extract_time [label="ğŸ•’ Heure Ã©vÃ©nement\nstartTimestamp", fillcolor="#ffcc02"];
        extract_location [label="ğŸ“ Lieu Ã©vÃ©nement\nentityMetadata.location", fillcolor="#ffcc02"];
        extract_description [label="ğŸ“„ Description\nevent.description", fillcolor="#ffcc02"];
        format_data [label="ğŸ¨ Formatage\n(timezone, liens)", fillcolor="#ffcc02"];
    }
    
    // Forum interaction
    subgraph cluster_forum {
        label="ğŸ“‹ Interaction forum";
        style=filled;
        fillcolor="#f3e5f5";
        
        search_existing [label="ğŸ” Recherche post existant\npar titre et date", fillcolor="#e1bee7"];
        compare_content [label="ğŸ”„ Comparaison\nheure, lieu, description", fillcolor="#e1bee7"];
        create_embed [label="ğŸ’ CrÃ©ation embed\nDiscord (couleur, champs)", fillcolor="#e1bee7"];
        forum_action [label="âš¡ Action forum\n(crÃ©er/mettre Ã  jour)", fillcolor="#e1bee7"];
    }
    
    // Decision points
    events_found [label="Ã‰vÃ©nements\ntrouvÃ©s ?", shape=diamond, fillcolor="#ffeb3b"];
    matching_event [label="Ã‰vÃ©nement\ncorrespondant ?", shape=diamond, fillcolor="#ffeb3b"];
    post_exists [label="Post forum\nexiste ?", shape=diamond, fillcolor="#ffeb3b"];
    content_different [label="Contenu\ndiffÃ©rent ?", shape=diamond, fillcolor="#ffeb3b"];
    
    // Outcomes
    use_event_data [label="âœ… Utiliser donnÃ©es\nÃ©vÃ©nement Discord", fillcolor="#4caf50", fontcolor="white"];
    use_defaults [label="âš™ï¸ Utiliser valeurs\npar dÃ©faut", fillcolor="#ff9800", fontcolor="white"];
    create_new [label="ğŸ“ CrÃ©er nouveau\npost forum", fillcolor="#2196f3", fontcolor="white"];
    update_existing [label="ğŸ”„ Mettre Ã  jour\npost existant", fillcolor="#9c27b0", fontcolor="white"];
    no_action [label="âœ… Aucune action\ndÃ©jÃ  Ã  jour", fillcolor="#607d8b", fontcolor="white"];
    
    // Error states
    api_error [label="âŒ Erreur API\n(timeout, permission)", fillcolor="#f44336", fontcolor="white"];
    forum_error [label="âŒ Erreur forum\n(permission, limite)", fillcolor="#f44336", fontcolor="white"];
    
    // Logging
    log_success [label="ğŸ“Š Log succÃ¨s\n(action, timestamp)", fillcolor="#4caf50", fontcolor="white"];
    log_error [label="ğŸ“Š Log erreur\n(dÃ©tails, context)", fillcolor="#f44336", fontcolor="white"];
    
    // Flow
    start -> api_call;
    
    // API flow with retry
    api_call -> timeout_check;
    timeout_check -> events_found [label="âœ… SuccÃ¨s"];
    timeout_check -> retry_logic [label="âŒ Timeout"];
    retry_logic -> api_call [label="Nouvelle tentative"];
    retry_logic -> api_error [label="3 Ã©checs"];
    
    // Event processing flow
    events_found -> filter_date [label="âœ… Oui"];
    events_found -> use_defaults [label="âŒ Aucun"];
    
    filter_date -> filter_keywords;
    filter_keywords -> recurrent_priority;
    recurrent_priority -> matching_event;
    
    matching_event -> extract_time [label="âœ… TrouvÃ©"];
    matching_event -> use_defaults [label="âŒ Aucun"];
    
    // Data extraction flow
    extract_time -> extract_location -> extract_description -> format_data;
    format_data -> use_event_data;
    
    // Forum interaction flow
    use_event_data -> search_existing;
    use_defaults -> search_existing;
    
    search_existing -> post_exists;
    post_exists -> compare_content [label="âœ… Existe"];
    post_exists -> create_embed [label="âŒ Nouveau"];
    
    compare_content -> content_different;
    content_different -> update_existing [label="âœ… DiffÃ©rent"];
    content_different -> no_action [label="âŒ Identique"];
    
    create_embed -> forum_action;
    forum_action -> create_new [label="Nouveau post"];
    forum_action -> update_existing [label="Mise Ã  jour"];
    forum_action -> forum_error [label="âŒ Erreur"];
    
    // Success logging
    create_new -> log_success;
    update_existing -> log_success;
    no_action -> log_success;
    
    // Error logging
    api_error -> log_error;
    forum_error -> log_error;
    
    // Timeline annotations
    edge [style=dotted, color="gray", fontsize=8];
    api_call -> api_call [label="~2-5 secondes"];
    search_existing -> search_existing [label="~1-2 secondes"];
    create_embed -> create_embed [label="~0.5 seconde"];
}